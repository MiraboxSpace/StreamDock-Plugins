<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authorization</title>
    <link rel="stylesheet" href="bootstrap.min.css">
    <link rel="stylesheet" href="bootstrap-icons.css">
    <style>
        html {
            width: 100%;
            height: 100%;
        }

        body {
            background-color: #2c2f33;
            color: white;
            font-family: Arial, sans-serif;
            overflow: hidden;
            width: 100%;
            height: 100%;
        }

        .card {
            background-color: #23272a;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .btn-primary {
            background-color: #7289da;
            border-color: #7289da;
        }

        .btn-primary:hover {
            background-color: #677bc4;
            border-color: #677bc4;
        }

        .form-control {
            background-color: #2c2f33;
            border: 1px solid #40444b;
            color: white;
        }

        .form-control:focus {
            background-color: #2c2f33;
            border-color: #7289da;
            box-shadow: 0 0 0 0.2rem rgba(114, 137, 218, 0.25);
            color: white;
        }

        .discord-link {
            color: #7289da;
            cursor: pointer;
            text-decoration: underline;
        }

        .discord-link:hover {
            color: #677bc4;
        }

        .tutorial-link {
            color: #7289da;
            cursor: pointer;
            text-align: center;
            display: block;
            margin-top: 15px;
        }

        .tutorial-link:hover {
            color: #677bc4;
            text-decoration: underline;
        }

        .header-icon {
            font-size: 2rem;
            color: #7289da;
            margin-bottom: 15px;
        }
    </style>
</head>

<body class="d-flex align-items-center justify-content-center">
    <div class="row justify-content-center" style="width: 100%;">
        <div class="col-10">
            <div class="card p-4">
                <div class="text-center">
                    <i class="bi bi-shield-lock header-icon"></i>
                    <h3 class="mb-4">Discord Authorization</h3>
                </div>

                <form id="authorizeBox">
                    <div class="mb-3">
                        <label for="open" class="form-label">获取ID</label>
                        <div class="sdpi-item-value discord-link" id="open">DEV网址</div>
                    </div>

                    <div class="mb-3">
                        <label for="clientId" class="form-label">CLIENT ID</label>
                        <input type="text" class="form-control" id="clientId" required>
                    </div>

                    <div class="mb-3">
                        <label for="clientSecret" class="form-label">CLIENT SECRET</label>
                        <input type="password" class="form-control" id="clientSecret" required>
                    </div>

                    <div class="d-grid mt-4">
                        <button type="button" class="btn btn-primary" id="authorizeBtn"><i class="bi bi-key"></i>请求授权</button>
                    </div>

                    <div class="text-center mt-3">
                        <span class="tutorial-link" id="tutorialLink"><i class="bi bi-journal-text"></i>View the tutorial</span>
                    </div>

                </form>
            </div>
        </div>
    </div>
</body>

<script>
    let $websocket = window.opener.$websocket;
    const clientId = document.querySelector("#clientId");
    const clientSecret = document.querySelector("#clientSecret");
    document.querySelector("#authorizeBtn").addEventListener('click', (e) => {
        if (clientId.value != null && clientId.value != '') {
            $websocket.setGlobalSettings({ clientId: clientId.value, clientSecret: clientSecret.value })
            // $websocket.openUrl("http://127.0.0.1:26432/authorization?clientId=" + clientId.value)
            window.close();
        }
    })

    document.querySelector("#open").addEventListener('click', () => {
        $websocket.openUrl('https://discord.com/developers/applications')
    })

    document.querySelector("#tutorialLink").addEventListener('click', () => {
        $websocket.openUrl('https://github.com/MiraboxSpace/discord-plugin-for-streamdock')
    })

    // 自动翻译页面
    $lang = window.opener.$lang;

    // 遍历文本节点并翻译所有文本节点
    const main = document.querySelector('#authorizeBox');
    const walker = document.createTreeWalker(main, NodeFilter.SHOW_TEXT, (e) => {
        return e.data.trim() && NodeFilter.FILTER_ACCEPT;
    });
    while (walker.nextNode()) {
        console.log(walker.currentNode.data);
        walker.currentNode.data = $lang[walker.currentNode.data];
    }
    // placeholder 特殊处理
    const translate = item => {
        if (item.placeholder?.trim()) {
            console.log(item.placeholder);
            item.placeholder = $lang[item.placeholder];
        }
    };
    document.querySelectorAll('input').forEach(translate);
    document.querySelectorAll('textarea').forEach(translate);
</script>

</html>